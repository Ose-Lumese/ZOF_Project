<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zero of Functions (ZOF) Solver</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font and base styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc;
        }
        .container-shadow {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 sm:p-8">

    <div class="max-w-6xl mx-auto">
        
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-blue-800">Zero of Functions (ZOF) Solver</h1>
            <p class="text-lg text-gray-600 mt-2">A Web GUI for Six Numerical Root-Finding Methods</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Column: Input Form -->
            <div class="lg:col-span-1 p-6 bg-white rounded-xl container-shadow h-fit sticky top-8">
                <h2 class="text-2xl font-semibold mb-4 text-gray-800">Solver Inputs</h2>
                
                <form id="solver-form" class="space-y-4">
                    
                    <!-- Function Input -->
                    <div>
                        <label for="function_expr" class="block text-sm font-medium text-gray-700">Function f(x) or g(x):</label>
                        <input type="text" id="function_expr" name="function_expr" value="x**3 - 2*x - 5" required
                               class="mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500 text-sm">
                        <p class="text-xs text-gray-500 mt-1">Use `x` for the variable and `**` for power (e.g., `x**3 - 2*x - 5`).</p>
                    </div>

                    <!-- Method Selection -->
                    <div>
                        <label for="method" class="block text-sm font-medium text-gray-700">Select Method:</label>
                        <select id="method" name="method" required
                                class="mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 bg-white focus:ring-blue-500 focus:border-blue-500 text-sm"
                                onchange="toggleInputs()">
                            <option value="Bisection">1. Bisection Method</option>
                            <option value="Regula Falsi">2. Regula Falsi (False Position)</option>
                            <option value="Secant">3. Secant Method</option>
                            <option value="Newton-Raphson" selected>4. Newton-Raphson Method</option>
                            <option value="Fixed Point">5. Fixed Point Iteration</option>
                            <option value="Modified Secant">6. Modified Secant Method</option>
                        </select>
                    </div>

                    <!-- Initial Guesses -->
                    <div id="guess-input-group" class="grid grid-cols-2 gap-4">
                        <div id="guess1-container">
                            <label for="guess1" class="block text-sm font-medium text-gray-700">Initial Guess 1 (x₀ / a):</label>
                            <input type="number" step="any" id="guess1" name="guess1" value="2" required
                                   class="mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500 text-sm">
                        </div>
                        <div id="guess2-container">
                            <label for="guess2" class="block text-sm font-medium text-gray-700">Initial Guess 2 (x₁ / b):</label>
                            <input type="number" step="any" id="guess2" name="guess2" value="3"
                                   class="mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500 text-sm">
                        </div>
                    </div>

                    <!-- Tolerance & Max Iterations -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="tolerance" class="block text-sm font-medium text-gray-700">Tolerance (ε):</label>
                            <input type="number" step="any" id="tolerance" name="tolerance" value="0.000001" required
                                   class="mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500 text-sm">
                        </div>
                        <div>
                            <label for="max_iterations" class="block text-sm font-medium text-gray-700">Max Iterations:</label>
                            <input type="number" id="max_iterations" name="max_iterations" value="50" required
                                   class="mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500 text-sm">
                        </div>
                    </div>
                    
                    <!-- Modified Secant Delta -->
                    <div id="delta-container" class="hidden">
                        <label for="delta" class="block text-sm font-medium text-gray-700">Perturbation (δ):</label>
                        <input type="number" step="any" id="delta" name="delta" value="0.01"
                               class="mt-1 block w-full rounded-lg border border-gray-300 shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500 text-sm">
                    </div>

                    <button type="submit" 
                            class="w-full py-3 px-4 border border-transparent rounded-lg shadow-md text-base font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150 ease-in-out">
                        <span id="button-text">Calculate Root</span>
                        <svg id="loading-spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </button>
                </form>
            </div>

            <!-- Right Columns: Results and Iterations -->
            <div class="lg:col-span-2 space-y-8">
                
                <!-- Results Card -->
                <div class="p-6 bg-white rounded-xl container-shadow">
                    <h2 class="text-2xl font-semibold mb-4 text-gray-800">Final Result</h2>
                    <div id="final-result-display" class="space-y-3">
                        <div class="text-sm font-medium text-red-500 bg-red-50 p-3 rounded-lg hidden" id="error-message"></div>
                        <p class="text-lg">
                            <span class="font-semibold text-gray-700">Method:</span> 
                            <span id="result-method" class="text-blue-600 font-bold">Newton-Raphson Method</span>
                        </p>
                        <p class="text-2xl">
                            <span class="font-semibold text-gray-700">Estimated Root (x*):</span> 
                            <span id="result-root" class="font-extrabold text-green-600">N/A</span>
                        </p>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <p><span class="font-semibold text-gray-700">Final Error (Ea):</span> <span id="result-error">N/A</span></p>
                            <p><span class="font-semibold text-gray-700">Iterations:</span> <span id="result-iterations">0</span></p>
                            <p><span class="font-semibold text-gray-700">Message:</span> <span id="result-message" class="text-gray-500">Awaiting calculation...</span></p>
                        </div>
                    </div>
                </div>

                <!-- Iteration Table -->
                <div class="p-6 bg-white rounded-xl container-shadow overflow-x-auto">
                    <h2 class="text-2xl font-semibold mb-4 text-gray-800">Iteration Details</h2>
                    <div id="iteration-table-container">
                        <table id="iteration-table" class="min-w-full divide-y divide-gray-200">
                            <!-- Table header and body will be populated by JavaScript -->
                            <thead></thead>
                            <tbody></tbody>
                        </table>
                        <p id="no-iterations" class="text-center text-gray-500 p-4">No iterations to display yet.</p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('solver-form');
        const methodSelect = document.getElementById('method');
        const guess1Container = document.getElementById('guess1-container');
        const guess2Container = document.getElementById('guess2-container');
        const guess2Input = document.getElementById('guess2');
        const deltaContainer = document.getElementById('delta-container');
        const errorMessage = document.getElementById('error-message');
        const loadingSpinner = document.getElementById('loading-spinner');
        const buttonText = document.getElementById('button-text');
        
        // Initial state update on load
        document.addEventListener('DOMContentLoaded', toggleInputs);

        function toggleInputs() {
            const method = methodSelect.value;
            
            // Default: Show Guess 1, Hide Guess 2, Hide Delta
            guess1Container.querySelector('label').textContent = 'Initial Guess 1 (x₀ / a):';
            guess2Container.classList.add('hidden');
            guess2Input.removeAttribute('required');
            deltaContainer.classList.add('hidden');
            document.getElementById('delta').removeAttribute('required');
            
            if (method === 'Bisection' || method === 'Regula Falsi') {
                // Bracket methods: need two guesses (a and b)
                guess1Container.querySelector('label').textContent = 'Initial Guess 1 (a):';
                guess2Container.classList.remove('hidden');
                guess2Container.querySelector('label').textContent = 'Initial Guess 2 (b):';
                guess2Input.setAttribute('required', 'required');
            } else if (method === 'Secant') {
                // Secant: needs two initial points (x0 and x1)
                guess1Container.querySelector('label').textContent = 'Initial Guess 1 (x₀):';
                guess2Container.classList.remove('hidden');
                guess2Container.querySelector('label').textContent = 'Initial Guess 2 (x₁):';
                guess2Input.setAttribute('required', 'required');
            } else if (method === 'Modified Secant') {
                // Modified Secant: needs one guess and delta
                guess1Container.querySelector('label').textContent = 'Initial Guess (x₀):';
                deltaContainer.classList.remove('hidden');
                document.getElementById('delta').setAttribute('required', 'required');
            }
            // Newton-Raphson and Fixed Point: only need Guess 1 (x0)
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Clear previous results and errors
            document.getElementById('iteration-table').querySelector('thead').innerHTML = '';
            document.getElementById('iteration-table').querySelector('tbody').innerHTML = '';
            document.getElementById('no-iterations').classList.remove('hidden');
            errorMessage.classList.add('hidden');
            document.getElementById('result-message').textContent = 'Calculating...';
            document.getElementById('result-root').textContent = 'N/A';
            document.getElementById('result-error').textContent = 'N/A';
            document.getElementById('result-iterations').textContent = '0';
            document.getElementById('result-method').textContent = methodSelect.options[methodSelect.selectedIndex].text;

            // Show loading spinner
            buttonText.classList.add('hidden');
            loadingSpinner.classList.remove('hidden');
            form.querySelector('button').disabled = true;

            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            // Convert empty guess2/delta strings to null for backend
            if (data.guess2 === "") data.guess2 = null;
            if (data.delta === "") data.delta = null;

            try {
                const response = await fetch('/solve', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    displayResults(result);
                } else {
                    errorMessage.textContent = result.message || 'An error occurred during calculation.';
                    errorMessage.classList.remove('hidden');
                    document.getElementById('result-message').textContent = 'Failed to converge.';
                }

            } catch (error) {
                console.error('Fetch error:', error);
                errorMessage.textContent = 'Network or server error. Please check the function syntax.';
                document.getElementById('result-message').textContent = 'Server error.';
            } finally {
                // Hide loading spinner
                buttonText.classList.remove('hidden');
                loadingSpinner.classList.add('hidden');
                form.querySelector('button').disabled = false;
            }
        });

        function displayResults(result) {
            document.getElementById('result-root').textContent = parseFloat(result.root).toFixed(8);
            document.getElementById('result-error').textContent = parseFloat(result.error).toExponential(2);
            document.getElementById('result-iterations').textContent = result.iterations;
            document.getElementById('result-message').textContent = result.message;

            const table = document.getElementById('iteration-table');
            const thead = table.querySelector('thead');
            const tbody = table.querySelector('tbody');
            
            tbody.innerHTML = '';
            
            if (result.history.length === 0) {
                document.getElementById('no-iterations').classList.remove('hidden');
                return;
            }

            document.getElementById('no-iterations').classList.add('hidden');

            const method = document.getElementById('method').value;
            
            let headers = ['Iter', 'x_new', 'f(x_new)', 'Error (Ea)'];
            let rowFormat = (d) => `
                <td class="p-2 whitespace-nowrap text-sm text-gray-500">${d.i}</td>
                <td class="p-2 whitespace-nowrap text-sm text-gray-900">${d.x_new.toFixed(6)}</td>
                <td class="p-2 whitespace-nowrap text-sm text-gray-500">${d.f_x.toExponential(4)}</td>
                <td class="p-2 whitespace-nowrap text-sm text-red-600 font-mono">${d.error.toExponential(4)}</td>
            `;

            if (method === 'Bisection' || method === 'Regula Falsi') {
                headers = ['Iter', 'a', 'b', 'x_new', 'f(x_new)', 'Error (Ea)'];
                rowFormat = (d) => `
                    <td class="p-2 whitespace-nowrap text-sm text-gray-500">${d.i}</td>
                    <td class="p-2 whitespace-nowrap text-sm text-gray-700">${d.a.toFixed(6)}</td>
                    <td class="p-2 whitespace-nowrap text-sm text-gray-700">${d.b.toFixed(6)}</td>
                    <td class="p-2 whitespace-nowrap text-sm text-gray-900">${d.x_new.toFixed(6)}</td>
                    <td class="p-2 whitespace-nowrap text-sm text-gray-500">${d.f_x.toExponential(4)}</td>
                    <td class="p-2 whitespace-nowrap text-sm text-red-600 font-mono">${d.error.toExponential(4)}</td>
                `;
            }

            thead.innerHTML = `
                <tr>
                    ${headers.map(h => `<th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">${h}</th>`).join('')}
                </tr>
            `;

            result.history.forEach(d => {
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50';
                row.innerHTML = rowFormat(d);
                tbody.appendChild(row);
            });
        }
    </script>

</body>
</html>